# PageRank算法

[TOC]



<img src="https://pic-1304701097.file.myqcloud.com/web/v2-d0a7452cb46a526f9c1fe946b227284f_1440w.jpg" alt="Google 网页排序算法 PageRank" style="zoom: 50%;" />

## 1. PageRank算法

### 1.1 概述

​		PageRank，又称网页排名，一种由搜索引擎**根据网页之间相互的超链接计算页面重要度**的技术，由Google创始人Larry Page提出。其结果可以用来体现网页的相关性和重要性，在搜索引擎优化操作中是经常被用来评估网页优化的成效因素之一。

- 一个网页的PageRank值可以理解为该网页被访问的概率。
- 如果一个网页被很多其他网页链接到，说明这个网页比较重要，也就是其PageRank值会相对较高。
- 如果一个PageRank值很高的网页链接到其他网页，那么被链接到的网页的PageRank值会相应地提高。

### 1.2 适用场景

- 网页排序
- 社交网络重点人物发掘

### 1.3 算法说明

> 假如网页A内有超链接指向网页B，那么称网页A为网页B的父页面		

简单认为，一个网页的影响力，受到它拥有的的父页面数量及它父页面拥有的影响力直接影响，用公式表达即：
$$
P R(u)=\sum_{v \in C_{u}} \frac{P R(v)}{L(v)}\tag{1}
$$
其中，														
$$
\begin{align}
&PR(u)\ --\ 表示u的PageRank值\\
&\ C_{u}\ \ \ \quad --\ 表示u的父页面集合\\
&L(v)\quad\  --\ 表示v的出度
\end{align}\tag{2}
$$
这里假设有四个网页$A,B,C,D$​，并且它们之间的链接关系如图。其中网页$A$​指向网页$B,C,D$​​​，网页$B$​指向网页$A,C$​​，而网页$C$​指向网页$D$​，网页$D$​指向网页$A,B$​。

<img src="https://pic-1304701097.file.myqcloud.com/web/PageRank.png" alt="image-20210810155652781" style="zoom:50%;" />

初始时，会给每个页面设置一个初始$PR$​​​​值，一般取$1/N$​，$N$​​为网页数量，即
$$
PR(A)=PR(B)=PR(C)=PR(D) =\frac{1}{4}\tag{3}
$$
那么第一次迭代之后，可以得到		
$$
P R(A)=\frac{P R(B)}{2}+\frac{P R(C)}{2}=\frac{1}{4}\\
P R(B)=\frac{P R(A)}{3}+\frac{P R(D)}{2}=\frac{5}{24}\\
....\tag{4}
$$
这里算法还不是完善的，如当一个网页的出度或入度为零时，会存在问题：

- **Rank Leak：**如果一个网页的出度为零，多次迭代之后，所有网页的PageRank值都会变为零

  <img src="https://pic-1304701097.file.myqcloud.com/web/image-20210811170921388.png" alt="image-20210811170921388" style="zoom:50%;" />

- **Rank Sink：**如果一个网页的入度为零，多次迭代之后，该网页的PageRank值会变为零

  <img src="https://pic-1304701097.file.myqcloud.com/web/image-20210812114158551.png" alt="image-20210812114158551" style="zoom:50%;" />

​		为了解决这个问题，Larry Page提出了随机冲浪浏览模型，即用户浏览网页不仅仅是通过网页内的超链接进行跳转，也有概率是随机输入一个网址进行跳转。因此引入了一个阻尼系数$d$，这个系数可以理解为用户通过网页内超链接进行跳转的概率，一般取0.85。所以公式（1）变为：
$$
P R(u)=\frac{1-d}{N}+d*\sum_{v \in C_{u}} \frac{PR(v)}{L(v)}\tag{5}
$$

> 这样每个页面的PR值最小为$(1-d)/N$。

----

为了计算方便，我们可以使用矩阵来表示网页之间的链接关系。则网页$A，B，C，D$间的链接关系对应矩阵如下：
$$
M=\left[\begin{array}{cccc}
0 & 1 / 2 & 0 & 1 / 2 \\
1 / 3 & 0 & 0 & 1 / 2 \\
1 / 3 & 1 / 2 & 0 & 0 \\
1 / 3 & 0 & 1 & 0
\end{array}\right]\tag{6}
$$

> $M$​<sub>$ij$​</sub>表示从网页$ j $​跳转到网页 $i $​的可能性（即$1/L(j)$​），这里$M$​<sub>$ij$​</sub>$>=0$​，且$\sum_{i=1}^{n} m_{i j}=1$​，即矩阵$M$​为随机矩阵（stochastic matrix）。

同样，每个页面的PageRank值也可以用列向量来表示，即				
$$
R=\left[\begin{array}{l}
1 / 4 \\
1 / 4 \\
1 / 4 \\
1 / 4
\end{array}\right]\tag{7}
$$
那么可得，						
$$
{R}=\frac{1-d}{N}{e}+d M {R}\tag{8}
$$

> 这里$e$为$N$维列向量，值都为1。

### 1.4 收敛与结果唯一

> ​	PageRank算法的核心在于证明公式（8）收敛且收敛值唯一，否则$R$的初始值会影响最终结果​

简单来说，我们需要先将公式（8）转换成马尔科夫链的形式，
$$
\begin{aligned} 
R &=\frac{1-d}{N} e + d M R \\ 
&=\left(\frac{1-d}{N} E+d M\right) R\\
&=M^{'}R
\end{aligned}\tag{9}
$$

> 这里$E$​是全为$1$的$N*N$​​的矩阵。

**根据定理：**不可约的非周期的有限状态马尔科夫链，有唯一平稳分布的存在，并且当时间趋于无穷时状态时分布收敛于唯一的平稳分布。

- **不可约：**当图是强连通，即每个节点都是可达。
- **非周期：**从有向图的任意一结点出发，再返回到这个结点的路径长度都是$x$​倍数，那么称这个结点为周期性结点。 如果一个有向图不含有周期性结点，则称这个有向图为非周期性图。$x$为大于$1$的自然数。 

而$M$​明显符合这两个条件，所以可证得PageRank收敛且收敛值唯一。

### 1.5 求解方法

- **迭代法**

  1. 初始化$R_0$

  2. 计算
     $$
     {R}(t+1)=\frac{1-d}{N}{e}+d M {R}(t)\tag{10}
     $$
     
  3. 如果$R_{t+1}$​​​​与$R_t$​​​​充分接近，则令$R$​​​​=$R_{t+1}$​​​​，并停止迭代
  
  4. 否则继续步骤（2）
  
- 幂法

  1. 随机初始化向量$x_0$
  2. 计算

  $$
  & {R_{t+1}}=M^{'}x_t \\
  & x_{t+1} = \frac{R_{t+1}}{||R_{t+1}||}\tag{11}
  $$

  

  3. 当${||x_{t+1}||}-{||x_{t}||}$足够小时，令$R$=${||x_{t}||}$​，停止迭代
  4. 否则继续步骤（2）

- **代数法**

  根据公式（8）可得：
  $$
  & (I-d M) R=\frac{1-d}{n} e \\
  & R=(I-d M)^{-1} \frac{1-d}{n} e\tag{12}
  $$
  当$0<d<1$时，方程（12）解存在且唯一。



## 2. PersonalRank算法

### 2.1 概述

​		PersonalRank算法又称Personalized PageRank算法。该算法继承了经典PageRank算法的思想，利用图链接结构来递归计算各节点的重要性。与PageRank算法不同的是，为了保证随机行走中各节点的访问概率能够反映出用户的偏好，PersonalRank算法在随机行走中的每次跳转会以$（1-d）$的概率返回到source节点，因此可以基于source节点个性化地计算网络节点的相关性和重要性。（PersonalRank值越高，source节点的相关性/重要性越高）。

### 2.2 适用场景

- 商品推荐
- 好友推荐
- 网页推荐

### 2.3 计算过程

$$
v=e\frac{1-d}{N}+dMv\\
$$

这里改变的只有$e$​值，原来$e$​是全1的N维列向量，现在$e$​变成只有$e$​<sub>$i$​</sub>为1的，其余值都为0的列向量。$i$​即我们要进行推荐的节点的下标​。





